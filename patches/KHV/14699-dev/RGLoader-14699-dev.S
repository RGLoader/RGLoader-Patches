# RGLoader patches file
# Patches follow same format as XeBuild, but with RGLP at start
# When used with RGLoader patch engine, they should be at 0xb0000 in the NAND (without ECC)
# [4byte offset] [4byte patch count] [4byte patch]...

# Devkit 14699 patches

.include "..\\..\\macros.S"


		.globl _start
_start:

# ============================================================================
#	RGLP header
	.long 0x52474C50
# ============================================================================

.ifdef NOFCRT
	.print "  --- FCRT DISABLED ---"
	.include "RGLoader-14699_nofcrt.S"
.endif

.ifdef NOMU
	.print "  --- MU DISABLED ---"
	.include "RGLoader-14699_noMU.S"
.endif

.ifdef SYSROOT
	.print "  --- SYSTEM ROOT MAPPED TO HDD ---"
	.include "RGLoader-14699_systemroot.S"
.endif

#----------------------------------------------------------



# ============================================================================
#       Retail XEX2 AES key
# ============================================================================
	KMAKEPATCH 0x800000F0 
0:
	.long 0x20B185A5
	.long 0x9D28FDC3
	.long 0x40583FBB
	.long 0x0896BF91
9:


# ============================================================================
#	HV jump to flag fixer
# ============================================================================
	KMAKEPATCH 0x800018C0
0:
	.long 0x4800AC02      #jump to flag clearing function
9:

# ============================================================================
#       KV check patches - Hvxkeyshmacsha
# ============================================================================
	KMAKEPATCH 0x80004C84 
0:
	nop
9:

# ============================================================================
#	HV Patch flag check
# ============================================================================
	KMAKEPATCH 0x80006920 
0:
	nop 
9:

#============================================================================
#	HV patch jump
# ============================================================================
	KMAKEPATCH 0x80006AD4
0:
	li %r3, 0 
9:

# ============================================================================
#       Patch XEX flag
# ============================================================================

	KMAKEPATCH 0x80006C08 
0:
	li %r3, 0
9:

	KMAKEPATCH 0x80006F94 
0:
	li %r4, 0x8
	li %r3, 0
9:

#============================================================================
#	HV Patch blow fuses              (protection against bad recovery disks etc)
# ============================================================================
	KMAKEPATCH 0x8000987C 
0:
	li %r3, 1 
	blr
9:


# ============================================================================
#	MachineCheck (mfspr   r3, LPCR)
# ============================================================================
	KMAKEPATCH 0x80000218 
0:
	.long 0x00000000
9:


# ============================================================================
#	HV Flag fixing function
# ============================================================================
	KMAKEPATCH 0x8000AC00 
0:
	lhz     %r3, 0x6(%r0)  # load flag byte into r3
	li      %r4, 0x20
	andc    %r3, %r3, %r4 # clear bit
	sth     %r3, 0x6(%r0)      # store new flag
	li      %r3, 0x200    # do what we patched
	ba      0x18C4  
9:

# ============================================================================
#       DVDAuth2 retail key
# ============================================================================
	KMAKEPATCH 0x80010B30
0:
	.long 0xD1E3B33A
	.long 0x6C1EF770
	.long 0x5F6DE93B
	.long 0xB6C0DC71
9:

# ============================================================================
#	HvxDvdAuthRecordXControl
# ============================================================================
	KMAKEPATCH 0x80026B1C 
0:
	.long 0x38600001
9:

# ============================================================================
#       HV DAE 
# ============================================================================
	KMAKEPATCH 0x80028E9C 
0:
	.long 0x38600000
	nop
9:

# ============================================================================
# 	Check if XEX decrypted properly, if not swap the key
# ============================================================================
	KMAKEPATCH 0x80029AA0 
0:
	.long 0x2B3C0000
	.long 0x419A0030
	.long 0x2F030000
	.long 0x409A0010
	.long 0x388000F0
	.long 0x48000018
	.long 0x60000000
9:

# ============================================================================
#	HvxSetImagePageTableEntry memory addr check
# ============================================================================
	KMAKEPATCH 0x80029C58 
0:
	.long 0x60000000
9:

# ============================================================================
#	HvxCreateImageMapping hash check
# ============================================================================
	KMAKEPATCH 0x8002C704 
0:
	.long 0x48000010
9:

#-----------------------------------------------------------------------

# ============================================================================
#	HV XEX region check -dev13599
# ============================================================================
	KMAKEPATCH 0x8002C7FC 
0:
	nop
9:




# ============================================================================
#	HvxExpansionInstall sig check
# ============================================================================
	KMAKEPATCH 0x80030BAC 
0:
	.long 0x60000000
9:

# ============================================================================
#	HvxExpansionInstall hash? (uses memcmp) check
# ============================================================================
	KMAKEPATCH 0x80030C2C 
0:
	.long 0x60000000
9:





# Kernel patches




# ============================================================================
#	Patch XEX Restrictions check
# ============================================================================

	KMAKEPATCH 0x800A2A98 
0:
	.long 0x38600001
9:

	KMAKEPATCH 0x800A0B2C 
0:
	.long 0x48000018
9:




# ============================================================================
#       SataCdRomAuthenticationExSequence
# ============================================================================
	KMAKEPATCH 0x800C4C08 
0:
	b 0x38
9:

#----------------------------------------------------------

# ============================================================================
#	SataCdRomActivateHCDFRuntimePatch TSST signature check
# ============================================================================
	KMAKEPATCH 0x800C461C 
0:
	.long 0x48000184  # b 0x184
9:

# ============================================================================
#	SataCdRomActivateHCDFRuntimePatch blacklisted drive check
# ============================================================================
	KMAKEPATCH 0x800C4638 
0:
	.long 0x48000168  # b 0x168
9:




# ============================================================================
#	XexpVerifyMedia Type?
# ============================================================================
	KMAKEPATCH 0x8009EA5C 
0:
	.long 0x38600001
9:

# ============================================================================
#	XexpVerifyXexHeaders
#       not really the same thing patched, what was patched got moved to HV
# ============================================================================
	KMAKEPATCH 0x800A0570 
0:
	.long 0x38600001
9:

# ============================================================================
#	XexpVerifyXexHeaders?
# ============================================================================
	KMAKEPATCH 0x800A0514 
0:
	.long 0x38600001  
9:

# ============================================================================
#	XexpVerifyMinimumVersion?
# ============================================================================
	KMAKEPATCH 0x800A1330 
0:
	.long 0x38600001
9:

# ============================================================================
#	XexpLoadFile?
# ============================================================================
	KMAKEPATCH 0x800A2BFC 
0:
	.long 0x38600001
9:


#-----------------------------------------------------------------------



#=============================================================================
#       nop out Shadowbooting on startup  
#=============================================================================


	KMAKEPATCH 0x8008180C 
0:
	nop
9:

#=============================================================================
#       disable shadow booting function   
#=============================================================================


	KMAKEPATCH 0x80081348 
0:
	li %r3, 0
	blr
9:



#-----------------------------------------------------------------------



# ============================================================================
#	XeKeysVerifyRSASignature -dev13599
# ============================================================================
	KMAKEPATCH 0x80144138
0:
	nop
9:
	KMAKEPATCH 0x8014416C 
0:
	li %r3, 1
9:


# ============================================================================
#	SataCdRomVerifyDVDX2AuthoringSignature -dev13599
# ============================================================================
	KMAKEPATCH 0x800C2C48 
0:
	li %r3, 1
9:

# ============================================================================
#	SataDiskAuthenticateDevice -dev13599
# ============================================================================
	KMAKEPATCH 0x801994A0 
0:
	li %r3, 1
9:

#==========THE FOLLOWING ARE NOT IMPORTANT AT THE MOMENT=====

# ============================================================================
#	XeKeysVerifyPIRSSignature -dev13599
# ============================================================================
	KMAKEPATCH 0x8014420C
0:
	li %r3, 1
9:

# ============================================================================
#	XeKeysConsoleSignatureVerification -dev13599
# ============================================================================
	KMAKEPATCH 0x8014617C
0:
	b 0x128
9:

# ============================================================================
#	StfsMapNewBlock hash mismatch -dev13599
# ============================================================================
	KMAKEPATCH 0x800E16F4 
0:
	.long 0x48000034
9:

# ============================================================================
#	SvodMapNewBlock hash mismatch -dev13599
# ============================================================================
	KMAKEPATCH 0x8017D070 
0:
	b 0x30
9:

# ============================================================================
#	SvodPartiallyCachedRead hash mismatch -dev13599
# ============================================================================
	KMAKEPATCH 0x8017D384 
0:
	nop
9:


# ============================================================================
	.long 0xffffffff
	.end
# ============================================================================

