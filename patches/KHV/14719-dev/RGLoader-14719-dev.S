# RGLoader patches file
# Patches follow same format as XeBuild, but with RGLP at start
# When used with RGLoader patch engine, they should be at 0xb0000 in the NAND (without ECC)
# [4byte offset] [4byte patch count] [4byte patch]...

# Devkit 14719 patches

.include "..\\..\\macros.S"

		.globl _start
_start:

# ============================================================================
#	RGLP header
	.long 0x52474C50  #"RGLP"
# ============================================================================

.ifdef NOFCRT
	.print "  --- FCRT DISABLED ---"
	.include "RGLoader-14719_nofcrt.S"
.endif

.ifdef NOMU
	.print "  --- MU DISABLED ---"
	.include "RGLoader-14719_noMU.S"
.endif

.ifdef SYSROOTHDD
	.print "  --- SYSTEM ROOT MAPPED TO HDD ---"
	.include "RGLoader-14719_sysroot_hdd.S"
.else

.ifdef SYSROOTMASS
	.print "  --- SYSTEM ROOT MAPPED TO USB ---"
	.include "RGLoader-14719_sysroot_mass.S"
.endif
.endif

.ifdef kd_1retry
	.print "  --- KD retries patched to 1 ---"
	.include "RGLoader-14719_kd_1retry.S"
.endif


#----------------------------------------------------------



# ============================================================================
#       Retail XEX2 AES key
# ============================================================================
	KMAKEPATCH 0x800000F0
0:
	.long 0x20B185A5
	.long 0x9D28FDC3
	.long 0x40583FBB
	.long 0x0896BF91
9:


# ============================================================================
#	HV jump to flag fixer
# ============================================================================
	KMAKEPATCH 0x800018B8 
0:
	ba  0xAC00      #jump to flag clearing function
9:

# ============================================================================
#	HV Flag fixing function
# ============================================================================
	KMAKEPATCH 0x8000AC00 
0:
	lhz     %r3, 0x6(%r0)  # load flag byte into r3
	li      %r4, 0x20
	andc    %r3, %r3, %r4 # clear bit
	sth     %r3, 0x6(%r0)      # store new flag
	cmpldi   %r21,  0    # do what we patched
	ba      0x18BC  
9:


# ============================================================================
#  KV check patches - Hvxkeyshmacsha
# ============================================================================
	KMAKEPATCH 0x80004D44  # First check on
0:
	nop
9:

# ============================================================================
#	HV Patch flag check
# ============================================================================
	KMAKEPATCH 0x80006A30 
0:
	nop 
9:

#============================================================================
#	HV patch jump
# ============================================================================
	KMAKEPATCH 0x80006BE4 
0:
	li %r3, 0 
9:

# ============================================================================
#       Patch XEX flag
# ============================================================================

	KMAKEPATCH 0x80006D20 
0:
	li %r3, 0
9:

	KMAKEPATCH 0x800070AC 
0:
	li %r4, 0x8
	li %r3, 0
9:

#============================================================================
#	HV Patch blow fuses              
# ============================================================================
	KMAKEPATCH 0x80009990
0:
	li %r3, 1 
	blr
9:


# ============================================================================
#	MachineCheck (mfspr   r3, LPCR)
# ============================================================================
	KMAKEPATCH 0x80000218
0:
	.long 0x00000000
9:




# ============================================================================
#       DVDAuth2 retail key
# ============================================================================
	KMAKEPATCH 0x80010B38
0:
	.long 0xD1E3B33A
	.long 0x6C1EF770
	.long 0x5F6DE93B
	.long 0xB6C0DC71
9:

# ============================================================================
#	HvxDvdAuthRecordXControl
# ============================================================================
	KMAKEPATCH 0x80026B4C 
0:
	li  %r3, 1
9:

# ============================================================================
#       HV DAE 
# ============================================================================
	KMAKEPATCH 0x80028ECC
0:
	li    %r3, 0
	nop
9:

# ============================================================================
# 	Check if XEX decrypted properly, if not swap the key
# ============================================================================
	KMAKEPATCH 0x80029AD0 
0:
	cmpldi  cr6,  %r28,  0
	beq     cr6,  0x30
	cmpwi   cr6,  %r3,  0
	bne     cr6,  0x10
	li      %r4,  0xF0
	b 0x18
	nop
9:

# ============================================================================
#	HvxSetImagePageTableEntry memory addr check
# ============================================================================
	KMAKEPATCH 0x80029C88 
0:
	nop
9:

# ============================================================================
#	HvxCreateImageMapping hash check
# ============================================================================
	KMAKEPATCH 0x8002C734 
0:
	b  0x10
9:

#-----------------------------------------------------------------------

# ============================================================================
#	HV XEX region check 
# ============================================================================
	KMAKEPATCH 0x8002C82C
0:
	nop
9:


# ============================================================================
#	HvxExpansionInstall sig check
# ============================================================================
	KMAKEPATCH 0x80030BAC
0:
	nop
9:

# ============================================================================
#	HvxExpansionInstall hash? (uses memcmp) check
# ============================================================================
	KMAKEPATCH 0x80030C2C 
0:
	nop
9:


# Kernel patches

# ============================================================================
#	Patch XEX Restrictions check
# ============================================================================

	KMAKEPATCH 0x800A2AE8 
0:
	li     %r3,  1
9:

	KMAKEPATCH 0x800A0B7C
0:
	b   0x18
9:




# ============================================================================
#       SataCdRomAuthenticationExSequence
# ============================================================================
	KMAKEPATCH 0x800C4C28 
0:
	b   0x38
9:

#----------------------------------------------------------

# ============================================================================
#	SataCdRomActivateHCDFRuntimePatch TSST signature check
# ============================================================================
	KMAKEPATCH 0x800C463C 
0:
	b   0x184
9:

# ============================================================================
#	SataCdRomActivateHCDFRuntimePatch blacklisted drive check
# ============================================================================
	KMAKEPATCH 0x800C4658
0:
	b   0x168
9:


# ============================================================================
#	XexpVerifyMedia Type
# ============================================================================
	KMAKEPATCH 0x8009EAAC
0:
	li   %r3,  1
9:

# ============================================================================
#	XexpVerifyXexHeaders
# ============================================================================
	KMAKEPATCH 0x800A05C0
0:
	li   %r3,  1
9:

# ============================================================================
#	XexpVerifyXexHeaders
# ============================================================================
	KMAKEPATCH 0x800A0564
0:
	li   %r3,  1 
9:

# ============================================================================
#	XexpVerifyMinimumVersion
# ============================================================================
	KMAKEPATCH 0x800A1380
0:
	li   %r3,  1
9:

# ============================================================================
#	XexpLoadFile
# ============================================================================
	KMAKEPATCH 0x800A2C4C
0:
	li   %r3,  1
9:


#-----------------------------------------------------------------------

#=============================================================================
#       nop out Shadowbooting on startup 
#=============================================================================
	KMAKEPATCH 0x8008180C
0:
	nop
9:

#=============================================================================
#       disable shadow booting function  
#=============================================================================
	KMAKEPATCH 0x80081348 
0:
	li %r3, 0
	blr
9:


#-----------------------------------------------------------------------



# ============================================================================
#	XeKeysVerifyRSASignature
# ============================================================================
	KMAKEPATCH 0x80144248 
0:
	nop
9:
	KMAKEPATCH 0x8014427C
0:
	li   %r3, 1
9:


# ============================================================================
#	SataCdRomVerifyDVDX2AuthoringSignature
# ============================================================================
	KMAKEPATCH 0x800C2BC8 
0:
	li   %r3, 1
9:

# ============================================================================
#	SataDiskAuthenticateDevice
# ============================================================================
	KMAKEPATCH 0x801995F0 
0:
	li   %r3, 1
9:

#==========THE FOLLOWING ARE NOT IMPORTANT AT THE MOMENT=====

# ============================================================================
#	XeKeysVerifyPIRSSignature
# ============================================================================
	KMAKEPATCH 0x8014431C 
0:
	li    %r3, 1
9:

# ============================================================================
#	XeKeysConsoleSignatureVerification
# ============================================================================
	KMAKEPATCH 0x8014628C 
0:
	b    0x128
9:

# ============================================================================
#	StfsMapNewBlock hash mismatch
# ============================================================================
	KMAKEPATCH 0x800E17C4 
0:
	b    0x34
9:

# ============================================================================
#	SvodMapNewBlock hash mismatch 
# ============================================================================
	KMAKEPATCH 0x8017D1C0 
0:
	b 0x30
9:

# ============================================================================
#	SvodPartiallyCachedRead hash mismatch
# ============================================================================
	KMAKEPATCH 0x8017D4D4
0:
	nop
9:



# ============================================================================
	.long 0xffffffff
	.end
# ============================================================================
